<div class="mx-4 my-4">
  <h1 class="text-2xl font-bold mb-6 text-center">Edit Resume Summary</h1>

  <%= form_with model: @resume, url: resume_path, method: :patch do |f| %>
    <div class="mx-4 my-4">
      <%= f.label :summary, class: "block text-gray-700 font-semibold mb-2" %>
      <%= f.rich_text_area :summary, class: "w-full border border-gray-300 rounded-md" %>
    </div>

    <div class="mx-4 my-4">
      <h2 class="text-xl font-bold mb-2">Work Experience</h2>

      <% @resume.experiences.each do |exp| %>
        <div class="mb-4 p-4 border rounded">
          <p class="font-semibold"><%= exp.title %> @ <%= exp.company_name %></p>
          <p class="text-sm text-gray-600">
            <%= exp.location %> â€”
            <%= exp.start_date.strftime("%b %Y") %> -
            <%= exp.end_date&.strftime("%b %Y") || "Present" %>
          </p>
          <ul class="list-disc list-inside mb-4">
            <% exp.responsibilities.each do |responsibility| %>
              <li style="margin-left: 1em"><%= responsibility.content %></li>
            <% end %>
          </ul>
          <span>
            <%= link_to "Edit", edit_resume_experience_path(@resume, exp), class: "text-blue-600 hover:underline mr-2" %>
            <%= link_to "Delete", resume_experience_path(@resume, exp), data: { turbo_method: :delete, confirm: "Are you sure?" }, class: "text-red-600 hover:underline", style: "margin-left: 1em" %>
          </span>
        </div>
      <% end %>

      <div class="mt-4">
        <%= link_to "Add Experience", new_resume_experience_path(@resume), class: "bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700" %>
      </div>
    </div>

    <div data-controller="responsibility" data-responsibility-scope="skills" class="mx-4 my-4">
      <h2 class="text-xl font-semibold mb-2">Technical Skills</h2>

      <% if @resume.skills.any? %>
        <p class="text-sm text-gray-600 mb-2">Existing skills: <%= @resume.skills.pluck(:name).join(', ') %></p>
        <details id="skills-section">
          <summary class="text-sm text-gray-600 mb-2 italic cursor-pointer bg-neutral-300 p-2 rounded-md border border-neutral-400">
            Open accordion to add, edit or remove a skill. Click the update resume button to save your changes.
          </summary>
          <div data-responsibility-target="container">
            <% @resume.skills.each_with_index do |skill, index| %>
              <%= skill_field_html(skill_name: skill.name, skill_id: skill.id, index: index, new_record: false) %>
            <% end %>
          </div>

          <template data-responsibility-target="template">
            <%= skill_field_html.html_safe %>
          </template>
        </details>
      <% end %>
      <%= link_to "Add Skill", "#", class: "text-blue-500", data: { action: "click->responsibility#add" } %>
    </div>

    <div data-controller="responsibility" data-responsibility-scope="education" class="mx-4 my-4">
      <h2 class="text-xl font-semibold mb-2">Education</h2>

      <div data-responsibility-target="container">
        <%= f.fields_for :educations do |edu_form| %>
          <%= render "educations/education_fields", f: edu_form %>
        <% end %>
      </div>

      <%= link_to "Add Education", "#", class: "text-blue-500", data: { action: "click->responsibility#add" } %>

      <div hidden data-responsibility-target="template">
        <%= capture do %>
          <%= f.fields_for(:educations, Education.new, child_index: "NEW_RECORD") do |edu_form| %>
            <%= render "educations/education_fields", f: edu_form %>
          <% end %>
        <% end %>
      </div>
    </div>

    <div data-controller="responsibility" data-responsibility-scope="projects" class="mx-4 my-4">
      <h2 class="text-xl font-semibold mb-2">Projects</h2>

      <div data-responsibility-target="container">
        <%= f.fields_for :projects do |proj_form| %>
          <%= render "projects/project_fields", f: proj_form %>
        <% end %>
      </div>

      <%= link_to "Add Project", "#", class: "text-blue-500", data: { action: "click->responsibility#add" } %>

      <div hidden data-responsibility-target="template">
        <%= capture do %>
          <%= f.fields_for(:projects, Project.new, child_index: "NEW_RECORD") do |proj_form| %>
            <%= render "projects/project_fields", f: proj_form %>
          <% end %>
        <% end %>
      </div>
    </div>

    <div class="mx-4 my-4 flex justify-center">
      <%= f.submit "Update Resume", class: 'text-white bg-gradient-to-r from-blue-500 via-blue-600 to-blue-700 hover:bg-gradient-to-br focus:ring-4 focus:outline-none focus:ring-blue-300 dark:focus:ring-blue-800 font-medium rounded-lg text-sm px-5 py-2.5 text-center me-2 mb-2 w-full md:w-2/3' %>
    </div>
  <% end %>
</div>
